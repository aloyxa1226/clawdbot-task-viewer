# PRD: ClawdBot Task Viewer

**Date:** 2026-01-27  
**Type:** Feature (Greenfield)  
**Generated by:** Gemini CLI (gemini-2.0-flash)

---

## PRODUCT INTENT (PI) — Locked after approval

### Problem Statement
"When ClawdBot breaks down complex work into tasks, visibility is limited to the terminal session. Users need a persistent, visual dashboard to: See what ClawdBot is working on across all sessions, Track task dependencies and understand blocking relationships, View historical task data with file attachments, Access the dashboard from anywhere via public URL" (From Research Document)

### Goals
- Provide a real-time, web-based dashboard for viewing ClawdBot tasks.
- Persist task data for 30 days with file attachments.
- Enable public access to the dashboard via a generated URL.

### Success Criteria
- [ ] Tasks appear on the board within 2 seconds of being pushed from ClawdBot.
- [ ] All active ClawdBot sessions are visible in the sidebar.
- [ ] Task dependencies (blocks/blockedBy) are clearly visualized in the UI.
- [ ] Historical tasks are searchable for up to 30 days.
- [ ] The application can be deployed with a single Docker Compose command.
- [ ] A public URL is generated automatically using Ngrok.

### Non-Goals (Out of Scope)
- User authentication or role-based access control.
- Fine-grained control over Ngrok configuration (beyond basic tunnel creation).
- Task editing or creation within the task viewer application.
- Support for task deletion for tasks that are not in a `pending` state.

---

## TECHNICAL SPEC (TS) — Can evolve during execution

### User Stories

#### [US-001]: Display Real-Time Tasks on Kanban Board
- **As a** user **I want** tasks pushed from ClawdBot to appear in real-time on a Kanban board **so that** I can immediately see what ClawdBot is working on.
- **Acceptance Criteria:**
  - [ ] Tasks pushed via the API appear on the Kanban board within 2 seconds.
  - [ ] The Kanban board displays tasks grouped by status (Pending, In Progress, Completed).
  - [ ] Typecheck passes

#### [US-002]: Visualize Task Dependencies
- **As a** user **I want** to see visual representations of task dependencies (blocks/blockedBy) **so that** I understand task relationships and blocking issues.
- **Acceptance Criteria:**
  - [ ] The UI displays visual cues indicating which tasks block or are blocked by other tasks.
  - [ ] Clicking on a task shows its dependencies in the detail panel.
  - [ ] Typecheck passes

#### [US-003]: List Active Sessions in Sidebar
- **As a** user **I want** a sidebar that displays all active ClawdBot sessions **so that** I can easily switch between different projects or sessions.
- **Acceptance Criteria:**
  - [ ] The sidebar lists all active sessions with session names.
  - [ ] The sidebar displays an activity indicator for sessions with recent updates.
  - [ ] Typecheck passes

#### [US-004]: Search Historical Tasks
- **As a** user **I want** to be able to search historical tasks **so that** I can find information about past projects and tasks.
- **Acceptance Criteria:**
  - [ ] A search bar is available in the UI.
  - [ ] Search results include tasks from the past 30 days.
  - [ ] Search results display relevant task details.
  - [ ] Typecheck passes

#### [US-005]: Display Task Details and Files
- **As a** user **I want** to see detailed information about each task, including file attachments **so that** I can understand the context and access relevant files.
- **Acceptance Criteria:**
  - [ ] Clicking on a task opens a detail panel.
  - [ ] The detail panel displays the task subject, description, status, and dependencies.
  - [ ] File attachments are listed with their names and content types.
  - [ ] Typecheck passes

#### [US-006]: Deploy with Docker Compose
- **As a** developer **I want** to deploy the application with a single Docker Compose command **so that** I can quickly set up the task viewer in any environment.
- **Acceptance Criteria:**
  - [ ] Running `docker-compose up` starts the application, PostgreSQL, and Redis.
  - [ ] The application is accessible in a web browser.
  - [ ] Typecheck passes

#### [US-007]: Public Access via Ngrok
- **As a** system administrator **I want** the application to automatically generate a public URL using Ngrok **so that** users can access the task viewer from anywhere.
- **Acceptance Criteria:**
  - [ ] On startup, the application creates an Ngrok tunnel.
  - [ ] The public URL is displayed in the console output.
  - [ ] The application remains accessible via the Ngrok URL.
  - [ ] Typecheck passes

### Functional Requirements
- FR-1: The API endpoint `/api/v1/sessions/:sessionKey/tasks` accepts POST requests with the specified JSON schema.
- FR-2: The application persists task data in a PostgreSQL database with a 30-day rolling retention policy.
- FR-3: The application uses Redis pub/sub for real-time updates to the Kanban board.
- FR-4: File attachments are stored on the filesystem, with file paths stored in the database.
- FR-5: A cron job automatically purges old task data and files older than 30 days.
- FR-6: Pending tasks can be deleted via the UI, which triggers a deletion in the database.

### Technical Considerations
- The application uses Node.js + TypeScript, PostgreSQL 16, Redis 7, React 18, TailwindCSS + shadcn/ui, Docker + Docker Compose, and Ngrok.
- The application integrates with the ClawdBot REST API for receiving task updates.
- File storage should be carefully managed to avoid running out of disk space.
- Ngrok free tier limitations (random URLs on restart) should be documented.
- Session keys are used for identifying sessions.
- Data model includes tables for Sessions, Tasks, and Task Files.
- Real-time flow involves ClawdBot pushing tasks via REST API, PostgreSQL updates, Redis PUBLISH, and SSE clients subscribing to Redis.
- The UI structure includes a sidebar for session list, a main Kanban board, and a detail panel for task details and files.

---

## Approval

- [ ] AL approves Product Intent (PI)
